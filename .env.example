# ========================================
# SARA - Sales Recovery Agent
# Environment Configuration Template
# ========================================
#
# IMPORTANT: DO NOT commit actual credentials to Git
# Copy this file to .env.local or .env and fill in real values
# .env files are in .gitignore and will never be committed
#

# ========================================
# Application Settings
# ========================================
NODE_ENV=development
PORT=3000
LOG_LEVEL=debug

# ========================================
# Database (Supabase PostgreSQL)
# ========================================
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://user:password@localhost:5432/sara_db

# ========================================
# Redis (Cache & Message Queue)
# ========================================
# Format: redis://username:password@host:port
# Used for:
#   - Bull job queue for async message processing
#   - Rate limiting (IP-based)
#   - Optional: conversation session caching
REDIS_URL=redis://default:password@localhost:6379

# ========================================
# OpenAI API
# ========================================
# Get key from: https://platform.openai.com/api-keys
# Used for:
#   - Message interpretation (NLU)
#   - Intent detection (price_question, objection, etc)
#   - Opt-out detection (fallback from deterministic)
#   - Response generation
# Model: gpt-3.5-turbo (cost-effective)
OPENAI_API_KEY=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

# ========================================
# WhatsApp Business API (Meta)
# ========================================

# Phone Number ID
# Your registered WhatsApp phone number ID
# Get from: https://developers.facebook.com/docs/whatsapp/cloud-api/phone-numbers
WHATSAPP_PHONE_ID=123456789012345

# Business Account ID
# Your WhatsApp Business Account ID
# Format: 15-digit numeric ID
WHATSAPP_BUSINESS_ACCOUNT_ID=123456789012345

# App ID
# Your Meta application ID
# Get from: https://developers.facebook.com/apps
WHATSAPP_APP_ID=123456789012345

# App Secret
# Used for HMAC-SHA256 signature verification of webhook requests
# Keep this secret and secure
WHATSAPP_APP_SECRET=your-secure-app-secret-min-20-chars

# Webhook Verification Token
# Used to validate webhook requests from Meta
# You can choose any secure random string (min 10 characters)
WHATSAPP_VERIFY_TOKEN=your-secure-random-token-min-10-chars

# Access Token
# Bearer token for WhatsApp API authentication
# Get from: Meta Business Platform → System User → Generate Token
# Token should have whatsapp_business_messaging scope
WHATSAPP_ACCESS_TOKEN=EAAbCdEfGhIjKlMnOpQrStUvWxYz

# Message Templates
# Template name sent on abandonment registration
# Must match the template name created in Meta Business Manager
# Supports {{user_name}} variable that will be replaced dynamically
WHATSAPP_TEMPLATE_INITIAL=boas_vindas_rcc_comandor

# ========================================
# SARA Configuration
# ========================================
# Conversation Management
# Maximum number of cycles (attempts) to recover a single abandonment
SARA_MAX_CYCLES=5

# Message Processing
# Number of recent messages to include in context for OpenAI
# Higher value = more context but larger tokens usage
SARA_MESSAGE_HISTORY_LIMIT=20

# System Prompt Caching
# TTL (Time To Live) for cached system prompt in milliseconds
# 3600000 = 1 hour
# Minimum: 60000 (1 minute)
SARA_SYSTEM_PROMPT_CACHE_TTL_MS=3600000

# OpenAI Integration
# Maximum number of retry attempts for OpenAI API calls
# Default: 3 (retry on failure with exponential backoff)
SARA_OPENAI_RETRY_MAX_ATTEMPTS=3

# Initial delay in milliseconds before first retry
# Subsequent retries use exponential backoff (delay * 2^attempt)
# Default: 1000ms (1 second)
SARA_OPENAI_RETRY_INITIAL_DELAY_MS=1000

# Webhook Rate Limiting
# Rate limit window in milliseconds (15 minutes = 900000)
SARA_WEBHOOK_RATE_LIMIT_WINDOW_MS=900000

# Maximum number of webhook requests allowed per phone number per window
# Default: 10 requests per 15 minutes per phone number
SARA_WEBHOOK_RATE_LIMIT_MAX_REQUESTS=10

# ========================================
# Monitoring (Optional - Phase 2)
# ========================================
# Sentry for error tracking
SENTRY_DSN=

# Datadog or other APM
DATADOG_API_KEY=

# ========================================
# Environment-Specific Notes
# ========================================
#
# Development (.env.local):
#   - Set NODE_ENV=development
#   - Set LOG_LEVEL=debug
#   - Use local or test database
#   - Use test Redis instance
#
# Staging (.env.staging):
#   - Set NODE_ENV=staging
#   - Set LOG_LEVEL=info
#   - Use staging database
#   - Use staging Redis
#   - Use staging WhatsApp API credentials
#
# Production (.env - never commit):
#   - Set NODE_ENV=production
#   - Set LOG_LEVEL=warn
#   - Use production database (encrypted)
#   - Use production Redis (encrypted)
#   - Use production WhatsApp API credentials
#   - Enable Sentry and monitoring
#
# Testing (.env.test):
#   - Set NODE_ENV=test
#   - Set LOG_LEVEL=error
#   - Use test database
#   - Use test Redis
#   - Use test/dummy credentials (file is in .gitignore)
